/*!build time : 2014-08-17 10:56:58 AM*/
KISSY.add("kg/cityfilter/0.0.1/index",["node","base"],function(a,b,c,d){var e=b.all,e=require("node").all,c=require("base"),f={trigger:"",width:105,lists:[["110000","\u5317\u4eac"],["310000","\u4e0a\u6d77"],["440100","\u5e7f\u5dde"],["440300","\u6df1\u5733"],["330100","\u676d\u5dde"]]},g=function(a){var b=this;g.superclass.constructor.call(b,a),b.init(a)};return a.extend(g,c,{init:function(b){var c=this;c.config=a.merge({},f,b),this._render(),this._bindEvent()},selectValue:"",_render:function(){var b=this,c=b.config;this.$input=e(c.trigger);var d=c.width;this.$p=e("<p>").addClass("tbc-city-tip").text("\u4e2d\u6587|\u62fc\u97f3|\u9996\u62fc"),this.$list=e("<ul>").addClass("tbc-city-list"),this.$more=e("<p>").addClass("tbc-city-more").text("\u66f4\u591a\u9009\u9879\u8bf7\u641c\u7d22"),this.$tbcCity=e('<div class="tbc-city">').css("width",d+"px").appendTo("body"),this.$tbcCity.append(this.$p).append(this.$list).append(this.$more);for(var f=0,g=c.lists,h=g.length;h>f;f++){var i=g[f];e('<li _value="'+i[0]+'">'+i[1]+"</li>").appendTo(b.$list)}e("li",this.$list).on("click",function(){var c=a.one(this),d=c.attr("_value"),e=c.text();b.$tbcCity.slideToggle(.2),b.setValue(d),b.setInput(e)})},_position:function(a){for(var b={x:0,y:0};a;a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return{left:b.x,top:b.y}},_setPosition:function(){var a=this,b=e(a.config.trigger),c=a._position(b[0]),d=parseInt(c.left,10),f=parseInt(c.top,10);f+=b.outerHeight(),a.$tbcCity.css({left:d,top:f})},_bindEvent:function(){var a=this;a.$input.on("focus",function(){a._setPosition(),a.$tbcCity.css("display","block")}),a.$input.on("keyup",function(){a.query()}),a.$input.on("mouseenter",function(){a.isblank=!1}).on("mouseleave",function(){a.isblank=!0}),e(document.body).on("click",function(){a.isblank&&a.$tbcCity.slideUp(.2)})},query:function(){var b=this,c=!1,f=b.$input.val().toLowerCase();if(0!==f.length){var g=[];for(var h in d){var i=d[h];"undefined"!=typeof i&&(0===i[2].indexOf(f)||0===i[3].indexOf(f)||0===i[1].indexOf(f))&&(c=!0,g.push([i[0],i[1]]))}if(c){b.$list.html("");for(var j in g){var k=g[j];if(e('<li _value="'+k[0]+'">'+k[1]+"</li>").appendTo(b.$list),j>=4)break}e("li",b.$list).detach("click"),e("li",b.$list).on("click",function(){var c=a.one(this),d=c.attr("_value"),e=c.text();b.$tbcCity.slideToggle(.2),b.setValue(d),b.setInput(e)})}}},setInput:function(a){this.$input.val(a)},setValue:function(a){this.$input.attr("_val",a),this.selectValue=a},getValue:function(){return this.selectValue}}),g},{requires:["node","base","./citylist","./index.css"]});